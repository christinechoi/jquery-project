<table>
  <h2 class="collectionTitle"><%= @collection.title %></h2>
  
  <h2 class="hitems"><% @collection.items.each do |item| %> </h2>
    <h3><%= link_to "#{item.brand} #{item.name}" %></h3>
  <% end %>
  

  <% @collection_items.each_with_index do |item, index| %>
      <tr>
        <h3 >
          <%= index + 1 %>. <%= link_to "#{item.brand} #{item.name}", collection_item_path(collection_id: @collection.id, id: item.id) %>
        </h3>

        <td>
          <%= link_to "Delete", collection_item_path(item.collection_id, item.id), method: :delete, data: { confirm: 'Are you sure you want to delete this item?' } , :class => "btn btn-default btn-sm" %>
        </td>

        <td>
          <%= link_to "Edit item", edit_collection_item_path(item.collection_id, item.id), method: :get, :class => "btn btn-default btn-sm" %><br>
        </td>
      </tr>
    <% end%>
  </table>

  <h3 ></h3>

<p>

  <%= link_to new_collection_item_path(collection_id: @collection.id), {class: "btn btn-default btn-lg"}, :method => :get do %>
      <span class="glyphicon glyphicon-plus"></span> Add Item
  <% end %>
</p>

<p>
  <a href="javascript:void(0)" class="js-next" data-id="<%= @collection.id %>">Next Collection </a>
</p>

<p>
  <%= link_to 'Back to Collections', collections_path %>
</p>

<p>
  <%= link_to 'Delete Collection', collection_path(@collection.id), method: :delete, data: { confirm: 'Are you sure you want to delete this collection?' } %>
</p>

<script type="text/javascript" charset="utf-8">

$(function () {
  $(".js-next").on("click", function() {
    var nextId = parseInt($(".js-next").attr("data-id")) + 1;
    $.get("/collections/" + nextId + ".json", function(data) {
  
      $(".collectionTitle").text(data["title"]);

      var clxItems = ""
      debugger;
      for (i = 0; i < data["items"].length; i++) {
        var obj = data["items"][i];
        var itemId = obj["id"];
        var itemTitle = obj["name"];
        var itemBrand = obj["brand"];

        clxItems += "<a href='collections/" + nextId + "/items/" + itemId + "'>" + " " + itemBrand + " " + itemTitle + "<br></a>";
      }
      debugger;
      $(".hitems").html(clxItems);
      // re-set the id to current on the link
      $(".js-next").attr("data-id", data["id"]);
    });
  });
});  

</script>




